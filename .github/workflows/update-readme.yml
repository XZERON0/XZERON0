name: Update Repo Count

on:
  schedule:
    - cron: "0 0 * * *"  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑ –≤ –¥–µ–Ω—å
  workflow_dispatch:  # –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        uses: actions/checkout@v2

      - name: –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö
        run: |
          curl -H "Authorization: token ${{ secrets.PAT_TOKEN }}" \
               -H "Accept: application/vnd.github.v3+json" \
               https://api.github.com/user/repos?per_page=100 > repo_data.json
          
          cat repo_data.json | jq -r '[.[] | {private: .private}] 
            | group_by(.private) 
            | map({"private": (map(select(.private == true)) | length), 
                   "public": (map(select(.private == false)) | length)})[0] 
            | "üåå Public Repositories: \(.public)\nüõ°Ô∏è Private Repositories: \(.private)"' > README.md

      - name: –ö–æ–º–º–∏—Ç –∏ –ø—É—à –∏–∑–º–µ–Ω–µ–Ω–∏–π
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add README.md
          git commit -m "Updated repo count" || exit 0
          git push
